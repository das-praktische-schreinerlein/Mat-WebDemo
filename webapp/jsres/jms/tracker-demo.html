<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">

<head>

    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-15"/>
    <title>Demo der JMSGeoMap-Blibliotheken</title>
    <meta http-equiv="Keywords" name="Keywords" content="Michael Schreiner,JMSGeoMap,Demo" />
    <meta http-equiv="Description" name="Description" content="Demo der JMSGeoMap-Blibliotheken" />
    <meta name="Expires" content="now" />
    <meta NAME="Keywords" content="Michael Schreiner,JMSGeoMap,Demo" />
    <meta NAME="Description" content="Demo der JMSGeoMap-Blibliotheken" />
    <meta NAME="author" CONTENT="P-Micha" />
    <meta NAME="page-topic" CONTENT="Homepage" />
    <meta NAME="page-type" CONTENT="Information" />
    <meta NAME="audience" CONTENT="Alle" />
    <meta NAME="robots" CONTENT="INDEX,FOLLOW" />
    <meta NAME="resource-type" CONTENT="document" />
    <meta NAME="distribution" CONTENT="global" />
    <meta NAME="Content-Language" CONTENT="de" />

<!-- APIs fuer Maps -->
<script type="text/javascript" src="../OpenLayers-2.11.js"></script>
<script type="text/javascript" src="../OpenStreetMap.js"></script>
<script type="text/javascript" src="http://www.openstreetmap.org/openlayers/OpenStreetMap.js"></script>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?v=3.5&amp;sensor=false"></script>
<script type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.2&amp;mkt=en-us"></script>

<!-- APIs fuer JMSGeoMap -->
<script type="text/javascript" src="./JMSBase.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeo.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoMap.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoMapBingMap.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoMapExtensions.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoMapGMap.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoMapOpenLayer.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoProfile.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoTracker.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSGeoTrackViewer.js?DUMMY=20130105"></script>
<script type="text/javascript" src="./JMSLayout.js?DUMMY=20130105"></script>
<script type="text/javascript" src="../jmat/JMATPageLayout.js"></script>
<script type="text/javascript" src="../jmat/JMATBase.js"></script>

<!-- Charts -->
<!--[if lt IE 9]><script language="javascript" type="text/javascript" src="../../jqplot/excanvas.js"></script><![endif]-->
<!--
<script type="text/javascript" src="http://michas-ausflugstipps.de/jqplot/jquery.min.js"></script>
<script type="text/javascript" src="http://michas-ausflugstipps.de/jqplot/jquery.jqplot.min.js"></script>
<link rel="stylesheet" type="text/css" href="http://michas-ausflugstipps.de/jqplot/jquery.jqplot.css" />
-->
<script type="text/javascript" src="../../jqplot/jquery.min.js"></script>
<script type="text/javascript" src="../../jqplot/jquery.jqplot.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../jqplot/jquery.jqplot.min.css" />

<style type="text/css">
/* Default-Styles */

v\:* {
  behavior:url(#default#VML);
}
html,body {
  background-color: #000000;
  height: 100%;
  width: 100%;
  font-family: Helvetica,Arial,sans-serif;
  color: white;
  font-size: 11px;
}

.olControlAttribution {
font-size: smaller;
right: 3px;
top: 1000px;
color: #000000;
}

/* JMSGeoMap-Styles */
.olPanelJMSGeoMapFeatures {
    left: auto;
    right: 8px;
    top: auto;
    bottom: 8px;
}
.olPanelJMSGeoMapFeatures div {
    width:  60px;
    height: 20px;
}
div.PanelButtonJMSGeoMapFeaturesTourItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_tour_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesTourItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_tour_inaktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesImageItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_image_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesImageItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_image_inaktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesTrackItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_track_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesTrackItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_track_inaktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesLocationItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_location_aktiv.gif");
}
div.PanelButtonJMSGeoMapFeaturesLocationItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_location_inaktiv.gif");
}
div.PanelButtonFullScreenItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_fullscreen_aktiv.gif");
}
div.PanelButtonFullScreenItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_fullscreen_aktiv.gif");
}
div.PanelButtonOsmSearchItemActive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_osmsearch_aktiv.gif");
}
div.PanelButtonOsmSearchItemInactive {
    background-image: url("http://www.michas-ausflugstipps.de/images/bt_base_osmsearch_aktiv.gif");
}
div.osm_search {
    font-size: 9px;
}
div.osm_search_title {
    font-size: 9px;
}
div.osm_search_content {
    font-size: 9px;
}
a.osm_search {
    font-size: 9px;
}
a.osm_search_title {
    font-size: 9px;
}
a.osm_search_content {
    font-size: 9px;
}
</style>

<script type="text/javascript">
jMATLogger = jMATService.initLogger("DEBUG");
</script>


<script type="text/javascript">
/*  */
/* globale Variablen + Configs */
/*  */

// konfigurieren, welche Daten geladen werden
var myUrl = this.location + "";
var pos = myUrl.search("TRACK=");
var urlGPX = "tracks.xml";
if (pos > 0) {
    urlGPX = myUrl.substring(pos+6, myUrl.length);
    pos = urlGPX.search("&");
    if (pos > 0) urlGPX = urlGPX.substring(0, pos);
    urlGPX = urlGPX.replace(/&/g, "_");
    urlGPX = urlGPX.replace(/\\/g, "_");
    urlGPX = urlGPX.replace(/:/g, "_");
    urlGPX = urlGPX.replace(/\//g, "_");
    urlGPX = "../../tracks/" + urlGPX;
}
var pos = myUrl.search("TRACK2=");
var urlGPX2 = "tracks.xml";
if (pos > 0) {
    urlGPX2 = myUrl.substring(pos+7, myUrl.length);
    pos = urlGPX2.search("&");
    if (pos > 0) urlGPX2 = urlGPX2.substring(0, pos);
    urlGPX2 = urlGPX2.replace(/&/g, "_");
    urlGPX2 = urlGPX2.replace(/\\/g, "_");
    urlGPX2 = urlGPX2.replace(/:/g, "_");
    urlGPX2 = urlGPX2.replace(/\//g, "_");
    urlGPX2 = "../../tracks/" + urlGPX2;
}

var flgGPSSimulation = 0;
var pos = myUrl.search("GPSSIMULATION=");
if (pos > 0) {
    flgGPSSimulation = 1;
}


// Variable fuer Ausschnitt
var mapMP = null;

// Configs
var flagGPX = 0; // 0 kein GPX laden; 1 nur Waypoints laden, 2 auch Touren ladden
var mapType = 0; // 0 OpenstreetMap, 1 GogleMaps 2, 2 Google Maps 3, 4 Bing V7

// Kartenmitte
var geoPos = new JMSGeoLatLon(49.32667, 11.02);

// Zoom-Level
var zoom = 10;
var globOptions = {
    supressLoadingOnMoveEnd: 0,
    supressImageLoading: 0,
    supressTourLoading: 0,
    supressTrackLoading: 0,
    supressLocationLoading: 0,
    MAPOPTIONS_OPENLAYERS: {
    }
};

// map-Variablen
var mapMP = null;
var gpsTracker = null;
var trackViewer = null;

// FullScreenUrl konfigurieren
globOptions.fullScreenFuncRef = function(fullMap) {
    openFullScreenMap();
};

function openFullScreenMap() {
    // Fullscreen-Fenster oeffnen
    var width = screen.availWidth;
    var height = screen.availHeight;
    var optionStr = "height=" + height + ",width=" + width + ",resizable=yes,scrollbars=no";
    var url = document.location;
    window.open(url, 'fullscreen', optionStr);
}

function onLoad() {
    // JMSGeoProfileObj anlegen
    var msChartObj = new JMSGeoProfile('chartdiv');

    // Map-Div auf Seitengroesse vergeossern
    var mapDivName = "mapDiv";
    var mapDiv = document.getElementById(mapDivName);

    // je nach MapType anderer Konstruktor
    if (mapType == 1) {
        // GMap2
        mapMP = new JMSGeoMapGMap2(mapDivName, globOptions);
    } else if (mapType == 2) {
        // GMap3
        mapMP = new JMSGeoMapGMap3(mapDivName, globOptions);
    } else if (mapType == 3) {
        // Bing
        mapMP = new JMSGeoMapBingMap(mapDivName, globOptions);
    } else {
        // Openstreetmap
        mapMP = new JMSGeoMapOpenLayer(mapDivName, globOptions);
    }

    // Karte anlegen
    mapMP.createMapObj();

    // Defaultlayer einbinden
    mapMP.addDefaultLayer();

    // OsmOrts-Suche einbinden
    mapMP.addOsmLocSearch('mapMP');

    // Default-Controls einbimdem
    mapMP.addDefaultControls();

    // Mittelpunkt setzen
    mapMP.setCenter(geoPos, zoom);

    // Ring setzen
    mapMP.setViewRectangle("mplayer", 0.35, 0.35);

    // MP-Controls hinzufuegen (Features ein/ausblenden, Ortsuche, FullScreen)
    mapMP.addJMSGeoMapFeatureControls();

    //////////////////////
    // TrackViewer initialisieren
    //////////////////////
    var trackerViewFuncRef = function (trackViewer) {
        var trackElement = document.getElementById('track');
        var track = trackElement.value;
        trackViewer.loadDocTrack(track);
    };
    var url1ViewFuncRef = function (trackViewer) {
        if (typeof (AppGeoTracker) == "undefined") {
            trackViewer.loadUrlTrack(urlGPX);
        } else {
            var track = AppGeoTracker.loadLocalGpxTrack(urlGPX);
            trackViewer.loadDocTrack(track);
        }
    };
    var url2ViewFuncRef = function (trackViewer) {
        if (typeof (AppGeoTracker) == "undefined") {
            trackViewer.loadUrlTrack(urlGPX2);
        } else {
            var track = AppGeoTracker.loadLocalGpxTrack(urlGPX2);
            trackViewer.loadDocTrack(track);
        }
    };
    var lstConfigShowTracks = new Array(
            trackerViewFuncRef,
            url1ViewFuncRef,
            url2ViewFuncRef);
    trackViewer = new JMSGeoTrackViewer(mapMP, msChartObj, lstConfigShowTracks);
    trackViewer.showTracks();
    
    // Um Feature zentrieren
    var delayedCenter = window.setInterval(
            function() {
                // nach 2 Sekunden ausfuehren und Intervall loeschen
                window.clearInterval(delayedCenter);

                trackViewer.doAfterRouteLoaded(msChartObj);
            }, 
            2000);

    //////////////////////
    // GPS-Tracker initialisieren
    //////////////////////

    // Tracker-FuncRef
    var trackerFuncRef = function (track) {
        var trackElement = document.getElementById('track');
        trackElement.value = track;
        
        // TRacls im Trackviewer anzeigen
        trackViewer.showTracks();
    };
    var exportInterval = 30
    var gpsName = "Tracker";
    var gpsInterval = 5;
    var flgGeoSimulation = flgGPSSimulation;
    gpsTracker = new JMSGeoTracker(trackerFuncRef, exportInterval, gpsName, gpsInterval, flgGeoSimulation);
}


function unLoad() {
    mapMP = null;
}
</script>



</head>
       <body bgcolor="#C1D2EC" link="#107AD1" onload="onLoad();" onunload="unLoad();">
       <div id="actiondiv">
          <input type="button" onclick="javascript: gpsTracker.startTrack();" value="Start Track">
          <input type="button" onclick="javascript: gpsTracker.stopTrack()" value="Stop Track">
          <input type="button" onclick="javascript: gpsTracker.continueTrack()" value="Track Fortf&uuml;hren">
       </div>
       <div id="mapDiv" style="width: 600px; height: 400px"></div>
       <br clear="all">
       <div id="data1" style="width: 600px;">
           <div style="width: 66%; float: left">
               Status:<span id="data_status1">Kein Track</span>
           </div>
           <div style="width: 33%; float: left;">
               Punkte:<span id="data_ok1"></span>
           </div>
           <br style="clear: both"/>
           <div style="width: 33%; float: left">
               Dist:<span id="data_dist1"></span> km
           </div>
           <div style="width: 33%; float: left">
           Asc:<span id="data_asc1"></span> Hm
           </div>
           <div style="width: 33%; float: left">
           Desc:<span id="data_desc1"></span> Hm
           </div>
           <br style="clear: both"/>
           <div style="width: 33%; float: left">
           Min:<span id="data_min1"></span> m
           </div>
           <div style="width: 33%; float: left">
           Max:<span id="data_max1"></span> m
           </div>
       </div>
       <div id="data2" style="width: 600px;">
           <div style="width: 66%; float: left">
               Status:<span id="data_status2">Kein Track</span>
           </div>
           <div style="width: 33%; float: left;">
               Punkte:<span id="data_ok2"></span>
           </div>
           <br style="clear: both"/>
           <div style="width: 33%; float: left">
               Dist:<span id="data_dist2"></span> km
           </div>
           <div style="width: 33%; float: left">
           Asc:<span id="data_asc2"></span> Hm
           </div>
           <div style="width: 33%; float: left">
           Desc:<span id="data_desc2"></span> Hm
           </div>
           <br style="clear: both"/>
           <div style="width: 33%; float: left">
           Min:<span id="data_min2"></span> m
           </div>
           <div style="width: 33%; float: left">
           Max:<span id="data_max2"></span> m
           </div>
       </div>
       <div id="data3" style="width: 600px;">
           <div style="width: 66%; float: left">
               Status:<span id="data_status3">Kein Track</span>
           </div>
           <div style="width: 33%; float: left;">
               Punkte:<span id="data_ok3"></span>
           </div>
           <br style="clear: both"/>
           <div style="width: 33%; float: left">
               Dist:<span id="data_dist3"></span> km
           </div>
           <div style="width: 33%; float: left">
           Asc:<span id="data_asc3"></span> Hm
           </div>
           <div style="width: 33%; float: left">
           Desc:<span id="data_desc3"></span> Hm
           </div>
           <br style="clear: both"/>
           <div style="width: 33%; float: left">
           Min:<span id="data_min3"></span> m
           </div>
           <div style="width: 33%; float: left">
           Max:<span id="data_max3"></span> m
           </div>
       </div>
       <br clear="all">
       <div id="chartdiv" style="height:200px;width:600px; "></div>
       <br clear="all">
       <div style="padding-top: 400px;">
          <textarea id="track" rows=20 cols=50> </textarea>
       </div>
   </body>
 </html>
